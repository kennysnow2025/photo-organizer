# Stage 1: 时间取证 (Time Forensics)

**目标**：确定照片最可信的 `Target Date`。
**输入**：用户上传的图片文件。
**输出**：确定的 `Target Date` 和 `Date Source`。

---

## 步骤 1: 检查 EXIF 元数据 (优先级 1)

**动作**：
检查图片文件是否包含 EXIF 信息。重点查找以下字段：
1. `DateTimeOriginal`
2. `GPSDateStamp`

**判断**：
- **如果存在有效日期**：
  - 提取该日期作为 `Target Date`。
  - 记录 `Date Source` 为 "EXIF"。
  - **跳转至 Stage 2**。
- **如果不存在**：
  - 进入步骤 2。

---

## 步骤 2: 分析文件名 (优先级 2)

**动作**：
分析文件名字符串，尝试匹配日期模式。

**匹配规则**：
1. **标准日期格式**：
   - `YYYYMMDD` (例如: `20231012`)
   - `YYYY-MM-DD` (例如: `2023-10-12`)
   - `IMG_YYYYMMDD`
2. **Unix 时间戳**：
   - 查找文件名中的 13 位或 10 位数字串 (例如微信图片: `mmexport1697092200000.jpg`)。
   - 尝试将其转换为日期时间。

**判断**：
- **如果匹配成功**：
  - 提取日期作为 `Target Date`。
  - 记录 `Date Source` 为 "Filename"。
  - **跳转至 Stage 2**。
- **如果匹配失败**：
  - 进入步骤 3。

---

## 步骤 3: OCR/视觉识别 (优先级 3)

**动作**：
如果是截屏（Screenshot）或包含文字的图片，尝试通过 OCR 读取时间信息。

**关注区域**：
1. 手机状态栏（顶部中央或角落）。
2. 聊天记录中的时间显示。
3. 文档或票据上的日期。

**判断**：
- **如果识别到有效日期**：
  - 提取日期作为 `Target Date`。
  - 记录 `Date Source` 为 "OCR"。
  - **跳转至 Stage 2**。
- **如果识别失败**：
  - 标记 `Target Date` 为 "Unknown"。
  - 记录 `Date Source` 为 "None"。
  - 提示用户："无法自动识别拍摄时间，请手动提供。"

---

## 结束本阶段

**输出示例**：
```json
{
  "target_date": "2023-10-12 14:30:00",
  "date_source": "Filename"
}
```
